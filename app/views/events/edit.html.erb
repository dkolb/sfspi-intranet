<%= render "shared/form_shims" %>
<%= javascript_tag 'setupDatePickerAutoSearch();' %>
<% can_edit = 
  is_admin? || current_user.record_link == @event.reporting_member_raw %>
<h1>Point Nun Report Form</h1>
<% unless can_edit %>
  <div class="invalid-feedback independent-feedback">
    You cannot edit this event as you did not submit it!
  </div>
<% end %>
<div class="container">
<%= form_tag(controller: 'events', action: 'edit_do', id: @event.id) do %>
<% unless can_edit %>
  <fieldset disabled>
<% end %>
    <%= form_entry(
      label_class(:event, :date, 'Date of Event'),
      date_field(:event, :date, value: @event.date, 
                 class: 'form-control datepicker', min: '2010-01-01')
    ) %>
    <div class="d-none" id="same_day_events_description">
      <p>These events are on the same day. Please do not submit duplicate events.
        Please click the link to edit that event.</p>
    </div>
    <div class="form-group row">
      <div class="col-sm-2"></div>
      <div class="col-sm-10">
        <div id="same_day_events"></div>
      </div>
    </div>
    <% if @event.new_record? %>
      <%= form_entry(
        label_class(:trash, :member, "Reporting Member"),
        text_field_tag('trash_member', 
                       @member.pseudonym, 
                       disabled: true, 
                       class: 'form-control', 
                       autocomplete: 'none')
      ) %>
      <%= hidden_field(:event, :reporting_member_raw, value: @member.id) %>
    <% else %>
        <%= form_entry(
          label_class(:trash, :member, "Reporting Member"),
          text_field_tag('trash_member', 
                         @event.reporting_member.pseudonym,
                         disabled: true, 
                         class: 'form-control', 
                         autocomplete: 'none')
        ) %>
      <%= hidden_field(:event, :reporting_member_raw) %>
    <% end %>
    <%= form_entry(
      label_class(:event, :name, 'Event Name'),
      text_field(:event, :name, class: 'form-control', autocomplete: 'none')
    ) %>
    <%= form_entry(
      label_class(:event, :venue, 'Venue'),
      text_field(:event, :venue, class: 'form-control')
    ) %>
    <%= form_entry(
      label_class(:event, :purpose, 'Purpose of Event'),
      text_field(:event, :purpose, class: 'form-control')
    ) %>
    <%= form_entry(
      label_class(:event, :successes, 'Event Sucesses'),
      text_field(:event, :successes, class: 'form-control')
    ) %>
    <%= form_entry(
      label_class(:event, :challenges, 'Event Challenges'),
      text_field(:event, :challenges, class: 'form-control')
    ) %>
    <%= member_checkboxes :event, :point_members_raw, 'Point Members', @event.errors %>
    <%= member_checkboxes :event, :attendees_raw, 'Attendees', @event.errors %>
    <%= hidden_field(:event, :form_filed) %>
<% if can_edit %>
    <%= submit("Create Event") %>
<% else %>
  </fieldset>
<% end %>
<% end %>
</div>

